<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Observatorio del Río Atoyac</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>



    <style>
/* Estilos generales */
html, body {
    height: 100%;
    margin: 0;
    display: flex;
    flex-direction: column;
}

/* Contenedor principal */
#main-container {
    flex: 1;
    display: flex;
    flex-direction: column;
    height: 100%;
    overflow: hidden; /* Evitar el desbordamiento */
}

/* Mapa */
#map-container {
    flex: 1;
    position: relative;
    height: 100%;
    z-index: 1;
}

#map {
    width: 100%;
    height: 100%;
    position: absolute;
}

/* Controles personalizados */
.custom-controls {
    position: absolute;
    top: 20px;
    left: 90px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    z-index: 1000;
}

.custom-controls button {
    background-color: white;
    border: none;
    border-radius: 5px;
    padding: 10px;
    cursor: pointer;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
    width: 40px;
    height: 40px;
    display: flex;
    justify-content: center;
    align-items: center;
}

.custom-controls button i, .custom-controls button span {
    font-size: 18px;
    color: #333;
}

.custom-controls button:hover {
    background-color: #f0f0f0;
}

/* Filtros de mapa personalizados */
.layer-control {
    background-color: rgba(255, 255, 255, 0.9);
    padding: 8px;
    border-radius: 10px;
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
    position: absolute;
    top: 10px;
    right: 10px;
    z-index: 1000;
    width: 300px;
    transition: opacity 0.3s ease-in-out;
    display: none;
}

.layer-control.open {
    display: block;
    opacity: 1;
}

.layer-control.closed {
    display: none;
    opacity: 0;
}

#layer-controls {
    display: none;
}

.toggle-button {
    background-color: white;
    border: none;
    border-radius: 30%;
    padding: 8px;
    cursor: pointer;
    position: absolute;
    top: 10px;
    right: 10px;
    z-index: 1001;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
    width: 40px;
    height: 40px;
    display: flex;
    justify-content: center;
    align-items: center;
}

/* Ajustes de tamaños de texto y elementos del acordeón */
.layer-control h5 {
    font-size: 0.85rem;
    margin-bottom: 8px;
    color: #333;
}

.accordion-header button {
    font-size: 0.8rem;
    padding: 5px;
}

.accordion-body {
    font-size: 0.8rem;
    padding: 6px;
}

.layer-control .layer-group {
    margin-bottom: 8px;
}

.layer-control input[type="checkbox"] {
    transform: scale(0.85);
    margin-right: 6px;
}

.layer-control input[type="range"] {
    width: 90%;
    transform: scale(0.85);
}

/* Logo en la parte inferior izquierda del mapa */
#logo_mapa {
    position: absolute;
    bottom: 10px;
    right: 160px;
    border-radius: 50%;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
    background-color: white;
    padding: 2px;
    z-index: 1000;
}

/* Cuadro de búsqueda centrado */
.leaflet-control-geosearch {
    position: absolute !important;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    width: 400px;
    max-width: 90%;
    z-index: 10000;
    font-family: 'Helvetica Neue', Arial, sans-serif;
}

/* Margen superior para la toolbar */
.leaflet-draw-toolbar-top,
.leaflet-draw-toolbar-bottom {
    margin-top: 10px;
}

/* Ajustes para los botones del draw control */
.leaflet-draw-toolbar a {
    margin: 10px !important;
    background-color: white !important;
    border: none !important;
    border-radius: 30% !important;
    padding: 8px !important;
    cursor: pointer !important;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3) !important;
    width: 40px !important;
    height: 40px !important;
    display: flex !important;
    justify-content: center !important;
    align-items: center !important;
}

.leaflet-bar-part.leaflet-bar-part-single {
    display: none !important;
}

.leaflet-draw-toolbar,
.leaflet-bar {
    border: none !important;
    box-shadow: none !important;
    margin: 0 !important;
    padding: 0 !important;
}

.leaflet-draw-toolbar a i, .leaflet-draw-toolbar a span {
    font-size: 18px !important;
    color: #333 !important;
}

.leaflet-draw-toolbar a:hover {
    background-color: #f0f0f0 !important;
}

/* Responsividad para pantallas medianas y pequeñas */
@media only screen and (max-width: 768px) {
    #map-container {
        height: 60vh;
    }

    .custom-controls button {
        width: 35px;
        height: 35px;
        font-size: 14px;
    }

    .layer-control {
        width: 220px;
        padding: 10px;
    }

    .toggle-button {
        width: 40px;
        height: 40px;
    }
}

@media only screen and (max-width: 480px) {
    #map-container {
        height: 50vh;
    }

    .custom-controls button {
        width: 30px;
        height: 30px;
        padding: 4px;
        font-size: 12px;
    }

    .layer-control {
        width: 160px;
        padding: 8px;
    }

    .toggle-button {
        width: 35px;
        height: 35px;
    }

    #logo_mapa {
        bottom: 50px;
        right: 10px;
        width: 40px;
        height: 40px;
    }

    /* Ocultar controles de zoom en móviles */
    .leaflet-control-zoom {
        display: none !important;
    }

    /* Ocultar footer en móviles */
    footer {
        display: none !important;
    }
} 


</style>

</head>

<body>

    <!-- Navbar Setup -->
    <nav class="navbar navbar-expand-lg navbar-light" style="background-color: #622132;">
        <div class="container-fluid">
            <a class="navbar-brand text-light" href="#">Observatorio del Río Atoyac</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                
                    <li class="nav-item">
                        <a class="nav-link text-light" href="#">
                            <i class="fas fa-bell text-white"></i> Sistema de Alerta Temprana
                        </a>
                    </li>
           
                    <li><a class="nav-link  text-light" aria-current="page" href="index.html">
                        <i class="bi bi-house-door-fill me-1"></i>Página Principal
                    </a></li>
                </ul>
            </div>
        </div>
    </nav>

<!-- Contenedor principal con mapa y controles -->
<div id="main-container">
    <div id="map-container">
        <div id="map"></div>
         <img src="img/logo_ciidir.jpeg" class="logo" id="logo_mapa" alt="GIISA" width="100px" height="100px">
        <!-- Controles personalizados a la izquierda -->

        <div class="custom-controls">
            <button id="zoom-in"><i class="fas fa-plus"></i></button>
            <button id="zoom-out"><i class="fas fa-minus"></i></button>
            <button id="fullscreen"><i class="fas fa-expand"></i></button>
            <button id="geolocate"><i class="fas fa-map-marker-alt"></i></button>
            <button id="share"><i class="fas fa-share-alt"></i></button>
            <button id="bookmark"><i class="fas fa-flag"></i></button>
            <button id="custom-hand"><i class="fas fa-hand-pointer"></i></button>
            <input type="file" id="kml-file" accept=".kml" style="display: none;" />
            <button id="kml"><span>KML</span></button>
        </div>

<!-- Filtro de capas con control de opacidad y botón de colapso -->
<div id="layer-control-container">
    <button id="toggle-layer-control" class="toggle-button">
        <i class="fas fa-layer-group"></i>
    </button>
    <div id="layer-controls" class="layer-control">
        <h5><strong>Capas de Mapa</strong></h5>
        
        <!-- Acordeón de Capas -->
        <div class="accordion" id="layerAccordion">

            <!-- Capas Base (PRIMERO) -->
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingBaseLayers">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseBaseLayers" aria-expanded="true" aria-controls="collapseBaseLayers">
                        <strong>Capas Base</strong>
                    </button>
                </h2>
                <div id="collapseBaseLayers" class="accordion-collapse collapse show" aria-labelledby="headingBaseLayers" data-bs-parent="#layerAccordion">
                    <div class="accordion-body">
                        <div class="layer-group">
                            <label for="chk-satelital">
                                <i class="fas fa-satellite-dish" style="color: blue;"></i> Satelital
                            </label>
                            <input type="checkbox" id="chk-satelital">
                            <input type="range" id="opacity-satelital" min="0" max="1" step="0.1" value="1">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Denuncias y Semáforo Ambiental -->
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingReports">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseReports" aria-expanded="false" aria-controls="collapseReports">
                        <strong>Denuncias y Semáforo Ambiental</strong>
                    </button>
                </h2>
                <div id="collapseReports" class="accordion-collapse collapse" aria-labelledby="headingReports" data-bs-parent="#layerAccordion">
                    <div class="accordion-body">
                        <div class="layer-group">
                            <label for="chk-denuncias">
                                <i class="fas fa-exclamation-triangle" style="color: #FF4500;"></i> Denuncias Ambientales
                            </label>
                            <input type="checkbox" id="chk-denuncias">
                            <input type="range" id="opacity-denuncias" min="0" max="1" step="0.1" value="1">
                            <p id="info-denuncias" style="display: none;">Denuncias de problemas ambientales reportados por la comunidad</p>
                        </div>
                        <div class="layer-group">
                            <label for="chk-semaforo">
                                <i class="fas fa-traffic-light" style="color: #FFD700;"></i> Semáforo Ambiental
                            </label>
                            <input type="checkbox" id="chk-semaforo">
                            <input type="range" id="opacity-semaforo" min="0" max="1" step="0.1" value="1">
                            <p id="info-semaforo" style="display: none;">Indicadores de riesgo ambiental clasificados por colores</p>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Buenas Prácticas -->
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingBestPractices">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseBestPractices" aria-expanded="false" aria-controls="collapseBestPractices">
                        <strong>Buenas Prácticas</strong>
                    </button>
                </h2>
                <div id="collapseBestPractices" class="accordion-collapse collapse" aria-labelledby="headingBestPractices" data-bs-parent="#layerAccordion">
                    <div class="accordion-body">
                        <div class="layer-group">
                            <label for="chk-suelos">
                                <i class="fas fa-seedling" style="color: #8B4513;"></i> Manejo de Suelos
                            </label>
                            <input type="checkbox" id="chk-suelos">
                            <input type="range" id="opacity-suelos" min="0" max="1" step="0.1" value="1">
                        </div>
                        <div class="layer-group">
                            <label for="chk-aguas">
                                <i class="fas fa-water" style="color: #1E90FF;"></i> Manejo de Aguas
                            </label>
                            <input type="checkbox" id="chk-aguas">
                            <input type="range" id="opacity-aguas" min="0" max="1" step="0.1" value="1">
                        </div>
                        <div class="layer-group">
                            <label for="chk-residuos">
                                <i class="fas fa-recycle" style="color: #228B22;"></i> Gestión de Residuos
                            </label>
                            <input type="checkbox" id="chk-residuos">
                            <input type="range" id="opacity-residuos" min="0" max="1" step="0.1" value="1">
                        </div>
                        <div class="layer-group">
                            <label for="chk-bosques">
                                <i class="fas fa-tree" style="color: #006400;"></i> Conservación de Bosques
                            </label>
                            <input type="checkbox" id="chk-bosques">
                            <input type="range" id="opacity-bosques" min="0" max="1" step="0.1" value="1">
                        </div>
                        <div class="layer-group">
                            <label for="chk-educacion">
                                <i class="fas fa-book" style="color: #FFA500;"></i> Educación Ambiental
                            </label>
                            <input type="checkbox" id="chk-educacion">
                            <input type="range" id="opacity-educacion" min="0" max="1" step="0.1" value="1">
                        </div>
                    </div>
                </div>
            </div>
            <!-- Recursos Hídricos -->
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingWaterResources">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseWaterResources" aria-expanded="false" aria-controls="collapseWaterResources">
                        <strong>Recursos Hídricos</strong>
                    </button>
                </h2>
                <div id="collapseWaterResources" class="accordion-collapse collapse" aria-labelledby="headingWaterResources" data-bs-parent="#layerAccordion">
                    <div class="accordion-body">
                        <div class="layer-group">
                            <label for="chk-geojson">
                                <i class="fas fa-water" style="color: #1E90FF;"></i> RH20Ac
                            </label>
                            <input type="checkbox" id="chk-geojson">
                            <input type="range" id="opacity-geojson" min="0" max="1" step="0.1" value="1">
                            <p id="info-geojson" style="display: none;">Subcuenca RH20Ac-R.Atoyac-Oaxaca DE Juárez</p>
                        </div>
                        <div class="layer-group">
                            <label for="chk-geojson-cuenca-atoyac">
                                <i class="fas fa-stream" style="color: #4682B4;"></i> Cuenca Hidrológica Río Atoyac-Salado 2021
                            </label>
                            <input type="checkbox" id="chk-geojson-cuenca-atoyac">
                            <input type="range" id="opacity-geojson-cuenca-atoyac" min="0" max="1" step="0.1" value="1">
                            <p id="info-geojson-cuenca-atoyac" style="display: none;">Volumen de disponibilidad de agua superficial (hectómetros cúbicos)</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Calidad del Agua -->
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingWaterQuality">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseWaterQuality" aria-expanded="false" aria-controls="collapseWaterQuality">
                        <strong>Calidad del Agua</strong>
                    </button>
                </h2>
                <div id="collapseWaterQuality" class="accordion-collapse collapse" aria-labelledby="headingWaterQuality" data-bs-parent="#layerAccordion">
                    <div class="accordion-body">
                        <div class="layer-group">
                            <label for="chk-geojson-calidad-agua">
                                <i class="fas fa-tint" style="color: #4CAF50;"></i> Indicadores Calidad Agua Superficial 2022
                            </label>
                            <input type="checkbox" id="chk-geojson-calidad-agua">
                            <input type="range" id="opacity-geojson-calidad-agua" min="0" max="1" step="0.1" value="1">
                            <p id="info-geojson-calidad-agua" style="display: none;">Indicadores de calidad de agua superficial en Oaxaca, 2022</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Infraestructura -->
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingInfrastructure">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInfrastructure" aria-expanded="false" aria-controls="collapseInfrastructure">
                        <strong>Infraestructura</strong>
                    </button>
                </h2>
                <div id="collapseInfrastructure" class="accordion-collapse collapse" aria-labelledby="headingInfrastructure" data-bs-parent="#layerAccordion">
                    <div class="accordion-body">
                        <div class="layer-group">
                            <label for="chk-geojson-plantas">
                                <i class="fas fa-industry" style="color: #FF6347;"></i> Plantas Tratamiento Agua Residual 2021
                            </label>
                            <input type="checkbox" id="chk-geojson-plantas">
                            <input type="range" id="opacity-geojson-plantas" min="0" max="1" step="0.1" value="1">
                            <p id="info-geojson-plantas" style="display: none;">Plantas municipales de tratamiento de agua residual 2021</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cambio Climático y Pronaii -->
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingClimateChange">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseClimateChange" aria-expanded="false" aria-controls="collapseClimateChange">
                        <strong>Cambio Climático y Pronaii</strong>
                    </button>
                </h2>
                <div id="collapseClimateChange" class="accordion-collapse collapse" aria-labelledby="headingClimateChange" data-bs-parent="#layerAccordion">
                    <div class="accordion-body">
                        <div class="layer-group">
                            <label for="chk-geojson-pronaii">
                                <i class="fas fa-cloud" style="color: #32CD32;"></i> HCTI Pronaii
                            </label>
                            <input type="checkbox" id="chk-geojson-pronaii">
                            <input type="range" id="opacity-geojson-pronaii" min="0" max="1" step="0.1" value="1">
                            <p id="info-geojson-pronaii" style="display: none;">Pronaii para el conocimiento y gestión en cuencas del ciclo socio-natural del agua para el bien común y la justicia ambiental por municipio a abril 2024</p>
                        </div>
                    </div>
                </div>
            </div>

            
        </div>
    </div>
</div>


 </div>
</div>



<div id="draw-controls" class="draw-controls-container">
    <!-- Los controles de dibujo y otros controles personalizados se agregan aquí -->
</div>




<!-- Pie de página optimizado -->
<footer class="footer-conacyt mt-4 py-2" style="background-color: #622132; color: #fff;">
    <div class="container">
        <div class="row align-items-center">
            <!-- Información de contacto -->
            <div class="col-md-3 d-flex align-items-center">
                <img src="img/conahcyt-blanco.svg" alt="GIISA" width="160px" height="50px">
            </div>

            <!-- Lo Institucional -->
            <div class="col-md-3 d-flex align-items-center">
                <img src="img/logo_ciddir.png" class="logo" id="logo_institucion" alt="GIISA" width="50px" height="50px">
            </div>

            <!-- Redes sociales mejoradas -->
            <div class="col-md-3">
                <h6>Síguenos en</h6>
                <ul class="list-inline mb-0">
                    <li class="list-inline-item me-2">
                        <a href="https://facebook.com/giisa" target="_blank" class="text-white">
                            <i class="fab fa-facebook"></i>
                        </a>
                    </li>
                    <li class="list-inline-item me-2">
                        <a href="https://twitter.com/giisa" target="_blank" class="text-white">
                            <i class="fab fa-twitter"></i>
                        </a>
                    </li>
                    <li class="list-inline-item me-2">
                        <a href="https://instagram.com/giisa" target="_blank" class="text-white">
                            <i class="fab fa-instagram"></i>
                        </a>
                    </li>
                    <li class="list-inline-item">
                        <a href="https://youtube.com/giisa" target="_blank" class="text-white">
                            <i class="fab fa-youtube"></i>
                        </a>
                    </li>
                </ul>
            </div>

            <!-- Contador de visitas -->
            <div class="col-md-3 text-center">
                <div class="contador">
                    <h6>Visitas a esta página</h6>
                    <h2 id="visit-count" class="text-white mb-0">0</h2>
                </div>
            </div>
        </div>
    </div>
</footer>



<script src="script/contador.js"></script>


<!-- Start of Async Drift Code -->
<script>
"use strict";

!function() {
  var t = window.driftt = window.drift = window.driftt || [];
  if (!t.init) {
    if (t.invoked) return void (window.console && console.error && console.error("Drift snippet included twice."));
    t.invoked = !0, t.methods = [ "identify", "config", "track", "reset", "debug", "show", "ping", "page", "hide", "off", "on" ], 
    t.factory = function(e) {
      return function() {
        var n = Array.prototype.slice.call(arguments);
        return n.unshift(e), t.push(n), t;
      };
    }, t.methods.forEach(function(e) {
      t[e] = t.factory(e);
    }), t.load = function(t) {
      var e = 3e5, n = Math.ceil(new Date() / e) * e, o = document.createElement("script");
      o.type = "text/javascript", o.async = !0, o.crossorigin = "anonymous", o.src = "https://js.driftt.com/include/" + n + "/" + t + ".js";
      var i = document.getElementsByTagName("script")[0];
      i.parentNode.insertBefore(o, i);
    };
  }
}();
drift.SNIPPET_VERSION = '0.3.1';
drift.load('iucsrsdafw3g');
</script>
<!-- End of Async Drift Code -->


<!-- Scripts Bootstrap y Leaflet -->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js"></script>
<script src="https://unpkg.com/leaflet-omnivore@0.3.4/leaflet-omnivore.min.js"></script>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-geosearch/dist/bundle.min.js"></script>
<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-minimap/dist/Control.MiniMap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>

<script>
    // Inicializar el mapa con Leaflet sin los controles de zoom predeterminados
    var map = L.map('map', {
        zoomControl: false,
        center: [17.0654, -96.7266],
        zoom: 10
    });

    // Sección 1: Capas Base
    var baseLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 18,
        attribution: '© OpenStreetMap'
    }).addTo(map);

        // Crear el minimapa
        var miniMapLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        });

        var miniMap = new L.Control.MiniMap(miniMapLayer, {
            toggleDisplay: true,
            minimized: false,
            position: 'bottomright'
        }).addTo(map);

    // Sección 2: Control Personalizado de Coordenadas
    var coordinatesControl = L.control({ position: 'bottomleft' });

    coordinatesControl.onAdd = function(map) {
        this._div = L.DomUtil.create('div', 'coordinates-control');
        this.update();
        return this._div;
    };

    coordinatesControl.update = function(latlng) {
        this._div.innerHTML = latlng ? `Lat: ${latlng.lat.toFixed(4)}, Lng: ${latlng.lng.toFixed(4)}` : 'Lat: --, Lng: --';
    };

    coordinatesControl.addTo(map);
    map.on('mousemove', function(e) {
        coordinatesControl.update(e.latlng);
    });

    // Añadir la escala al mapa en la parte inferior izquierda
    L.control.scale({
        position: 'bottomleft',
        imperial: false
    }).addTo(map);

    // Sección 3: Marca de Agua
    var watermarkBounds = [[17.8, -97.5], [16.5, -96]];
    L.imageOverlay('img/logo_ciddir.png', watermarkBounds, {
        opacity: 0.1
    }).addTo(map);

    // Sección 4: Capas GeoJSON y manejo de capas 
    // Sección 4: Capas GeoJSON
    // Crear capas adicionales (GeoJSON)
    var satelitalLayer = L.tileLayer('https://www.google.cn/maps/vt?lyrs=s@189&gl=cn&x={x}&y={y}&z={z}', { opacity: 1 });

    // Crear la capa GeoJSON RH20Ac (inicialmente vacía)
    var geojsonLayer = L.geoJSON(null, { opacity: 1 });
    var geojsonLayerLoaded = false;

    // Crear la capa GeoJSON HCTI Pronaii (inicialmente vacía)
    var geojsonPronaiiLayer = L.geoJSON(null, {
        opacity: 1,
        onEachFeature: function (feature, layer) {
            var popupContent = "<strong>Municipio:</strong> " + feature.properties.nom_mun + "<br>" +
                "<strong>Pronace:</strong> " + feature.properties.nom_pronace + "<br>" +
                "<strong>Acciones:</strong> " + feature.properties.acciones;
            layer.bindPopup(popupContent);
        }
    });
    var geojsonPronaiiLayerLoaded = false;

    // Crear la capa GeoJSON Plantas Tratamiento de Agua Residual (inicialmente vacía)
    var geojsonPlantasLayer = L.geoJSON(null, {
        opacity: 1,
        onEachFeature: function (feature, layer) {
            var popupContent = "<strong>Planta de Tratamiento:</strong> " + feature.properties.nom_mun + "<br>" +
                "<strong>Descripción:</strong> " + "Plantas municipales de tratamiento de agua residual en el año 2021";
            layer.bindPopup(popupContent);
        }
    });
    var geojsonPlantasLayerLoaded = false;

    // Crear la capa GeoJSON Indicadores Calidad de Agua Superficial (inicialmente vacía)
    var geojsonCalidadAguaLayer = L.geoJSON(null, {
        pointToLayer: function (feature, latlng) {
            var color;
            switch (feature.properties.semaforo) {
                case "VERDE":
                    color = "#4CAF50";
                    break;
                case "AMARILLO":
                    color = "#FFEB3B";
                    break;
                case "ROJO":
                    color = "#F44336";
                    break;
                default:
                    color = "#000000";
            }
            return L.circleMarker(latlng, {
                radius: 8,
                fillColor: color,
                color: "#000",
                weight: 1,
                opacity: 1,
                fillOpacity: 0.8
            });
        },
        onEachFeature: function (feature, layer) {
            var popupContent = "<strong>Sitio:</strong> " + feature.properties.sitio + "<br>" +
                "<strong>Municipio:</strong> " + feature.properties.nom_municipio + "<br>" +
                "<strong>Semáforo:</strong> " + feature.properties.semaforo;
            layer.bindPopup(popupContent);
        }
    });
    var geojsonCalidadAguaLayerLoaded = false;

    // Crear la capa GeoJSON Cuenca Hidrológica Río Atoyac-Salado (inicialmente vacía)
    var geojsonCuencaAtoyacLayer = L.geoJSON(null, {
        style: function (feature) {
            return {
                color: "#4682B4",
                weight: 2,
                opacity: 1
            };
        },
        onEachFeature: function (feature, layer) {
            var popupContent = "<strong>Cuenca:</strong> " + feature.properties.nom_cuenca + "<br>" +
                "<strong>Volumen Disponible:</strong> " + feature.properties.vol_dispo + " hectómetros cúbicos";
            layer.bindPopup(popupContent);
        }
    });
    var geojsonCuencaAtoyacLayerLoaded = false;

     // Sección 5: Manejo de Capas
    // Añadir los listeners para mostrar/ocultar las capas con los checkboxes
    document.getElementById('chk-satelital').addEventListener('change', function() {
        if (this.checked) {
            map.addLayer(satelitalLayer);
        } else {
            map.removeLayer(satelitalLayer);
        }
    });

    // Mostrar/ocultar la capa GeoJSON RH20Ac
    document.getElementById('chk-geojson').addEventListener('change', function() {
        var infoGeojson = document.getElementById('info-geojson');
        if (this.checked) {
            if (!geojsonLayerLoaded) {
                fetch('https://raw.githubusercontent.com/h3rm3/mockup1/refs/heads/main/salida_reproyectada.geojson')
                    .then(response => response.json())
                    .then(data => {
                        geojsonLayer.addData(data);  // Añadir los datos al layer
                        geojsonLayerLoaded = true;
                        map.addLayer(geojsonLayer);
                        map.fitBounds(geojsonLayer.getBounds());  // Ajustar el mapa a los límites de la capa GeoJSON
                    })
                    .catch(error => console.log("Error al cargar el GeoJSON RH20Ac:", error));
            } else {
                map.addLayer(geojsonLayer);
            }
            infoGeojson.style.display = 'block';
        } else {
            map.removeLayer(geojsonLayer);  // Remover la capa del mapa
            infoGeojson.style.display = 'none';
        }
    });

    // Mostrar/ocultar la capa GeoJSON HCTI Pronaii
    document.getElementById('chk-geojson-pronaii').addEventListener('change', function() {
        var infoGeojsonPronaii = document.getElementById('info-geojson-pronaii');
        if (this.checked) {
            if (!geojsonPronaiiLayerLoaded) {
                fetch('https://raw.githubusercontent.com/h3rm3/GIISA/refs/heads/main/hcti_pronaii_ciclo_agua_300424_mun_p.geojson')
                    .then(response => response.json())
                    .then(data => {
                        geojsonPronaiiLayer.addData(data);  // Añadir los datos al layer
                        geojsonPronaiiLayerLoaded = true;
                        map.addLayer(geojsonPronaiiLayer);
                        map.fitBounds(geojsonPronaiiLayer.getBounds());  // Ajustar el mapa a los límites de la capa GeoJSON Pronaii
                    })
                    .catch(error => console.log("Error al cargar el GeoJSON HCTI Pronaii:", error));
            } else {
                map.addLayer(geojsonPronaiiLayer);
            }
            infoGeojsonPronaii.style.display = 'block';
        } else {
            map.removeLayer(geojsonPronaiiLayer);  // Remover la capa del mapa
            infoGeojsonPronaii.style.display = 'none';
        }
    });

    // Mostrar/ocultar la capa GeoJSON Plantas Tratamiento de Agua Residual
    document.getElementById('chk-geojson-plantas').addEventListener('change', function() {
        var infoGeojsonPlantas = document.getElementById('info-geojson-plantas');
        if (this.checked) {
            if (!geojsonPlantasLayerLoaded) {
                fetch('https://raw.githubusercontent.com/h3rm3/GIISA/refs/heads/main/oaxaca_plantas_filtrado.geojson')
                    .then(response => response.json())
                    .then(data => {
                        geojsonPlantasLayer.addData(data);  // Añadir los datos al layer
                        geojsonPlantasLayerLoaded = true;
                        map.addLayer(geojsonPlantasLayer);
                        map.fitBounds(geojsonPlantasLayer.getBounds());  // Ajustar el mapa a los límites de la capa GeoJSON Plantas
                    })
                    .catch(error => console.log("Error al cargar el GeoJSON Plantas Tratamiento de Agua Residual:", error));
            } else {
                map.addLayer(geojsonPlantasLayer);
            }
            infoGeojsonPlantas.style.display = 'block';
        } else {
            map.removeLayer(geojsonPlantasLayer);  // Remover la capa del mapa
            infoGeojsonPlantas.style.display = 'none';
        }
    });

    // Mostrar/ocultar la capa GeoJSON Indicadores Calidad de Agua Superficial
    document.getElementById('chk-geojson-calidad-agua').addEventListener('change', function() {
        var infoGeojsonCalidadAgua = document.getElementById('info-geojson-calidad-agua');
        if (this.checked) {
            if (!geojsonCalidadAguaLayerLoaded) {
                fetch('https://raw.githubusercontent.com/h3rm3/GIISA/refs/heads/main/ind_calidad_agua_superf_oaxaca.geojson')
                    .then(response => response.json())
                    .then(data => {
                        geojsonCalidadAguaLayer.addData(data);  // Añadir los datos al layer
                        geojsonCalidadAguaLayerLoaded = true;
                        map.addLayer(geojsonCalidadAguaLayer);
                        map.fitBounds(geojsonCalidadAguaLayer.getBounds());  // Ajustar el mapa a los límites de la capa GeoJSON Calidad de Agua
                    })
                    .catch(error => console.log("Error al cargar el GeoJSON Calidad de Agua Superficial:", error));
            } else {
                map.addLayer(geojsonCalidadAguaLayer);
            }
            infoGeojsonCalidadAgua.style.display = 'block';
        } else {
            map.removeLayer(geojsonCalidadAguaLayer);  // Remover la capa del mapa
            infoGeojsonCalidadAgua.style.display = 'none';
        }
    });

    // Mostrar/ocultar la capa GeoJSON Cuenca Hidrológica Río Atoyac-Salado
    document.getElementById('chk-geojson-cuenca-atoyac').addEventListener('change', function() {
        var infoGeojsonCuencaAtoyac = document.getElementById('info-geojson-cuenca-atoyac');
        if (this.checked) {
            if (!geojsonCuencaAtoyacLayerLoaded) {
                fetch('https://raw.githubusercontent.com/h3rm3/GIISA/refs/heads/main/cuenca_hidrologica_R%C3%ADoAtoyac-Salado.geojson')
                    .then(response => response.json())
                    .then(data => {
                        geojsonCuencaAtoyacLayer.addData(data);  // Añadir los datos al layer
                        geojsonCuencaAtoyacLayerLoaded = true;
                        map.addLayer(geojsonCuencaAtoyacLayer);
                        map.fitBounds(geojsonCuencaAtoyacLayer.getBounds());  // Ajustar el mapa a los límites de la capa GeoJSON Cuenca Atoyac
                    })
                    .catch(error => console.log("Error al cargar el GeoJSON Cuenca Hidrológica Río Atoyac-Salado:", error));
            } else {
                map.addLayer(geojsonCuencaAtoyacLayer);
            }
            infoGeojsonCuencaAtoyac.style.display = 'block';
        } else {
            map.removeLayer(geojsonCuencaAtoyacLayer);  // Remover la capa del mapa
            infoGeojsonCuencaAtoyac.style.display = 'none';
        }
    });

    // Controlar la opacidad de la capa GeoJSON RH20Ac
    document.getElementById('opacity-geojson').addEventListener('input', function() {
        geojsonLayer.setStyle({ opacity: this.value });  // Ajustar la opacidad
    });

    // Controlar la opacidad de la capa GeoJSON HCTI Pronaii
    document.getElementById('opacity-geojson-pronaii').addEventListener('input', function() {
        geojsonPronaiiLayer.setStyle({ opacity: this.value });  // Ajustar la opacidad
    });

    // Controlar la opacidad de la capa GeoJSON Plantas Tratamiento de Agua Residual
    document.getElementById('opacity-geojson-plantas').addEventListener('input', function() {
        geojsonPlantasLayer.setStyle({ opacity: this.value });  // Ajustar la opacidad
    });

    // Controlar la opacidad de la capa GeoJSON Indicadores Calidad de Agua Superficial
    document.getElementById('opacity-geojson-calidad-agua').addEventListener('input', function() {
        geojsonCalidadAguaLayer.setStyle({ opacity: this.value });  // Ajustar la opacidad
    });

    // Controlar la opacidad de la capa GeoJSON Cuenca Hidrológica Río Atoyac-Salado
    document.getElementById('opacity-geojson-cuenca-atoyac').addEventListener('input', function() {
        geojsonCuencaAtoyacLayer.setStyle({ opacity: this.value });  // Ajustar la opacidad
    });

    // Controlar la opacidad de las capas con los sliders
    document.getElementById('opacity-satelital').addEventListener('input', function() {
        satelitalLayer.setOpacity(this.value);
    });

    // Sección 6: Controles Personalizados
    // Controles personalizados de zoom
    document.getElementById('zoom-in').addEventListener('click', function() {
        map.zoomIn();
    });

    document.getElementById('zoom-out').addEventListener('click', function() {
        map.zoomOut();
    });

    document.getElementById('fullscreen').addEventListener('click', function() {
        if (!document.fullscreenElement) {
            document.getElementById('map-container').requestFullscreen();
        } else {
            document.exitFullscreen();
        }
    });

    document.getElementById('geolocate').addEventListener('click', function() {
        map.locate({ setView: true, maxZoom: 16 });
    });

    document.getElementById('share').addEventListener('click', function() {
        alert("Función para compartir el mapa");
    });

    document.getElementById('bookmark').addEventListener('click', function() {
        var marker = L.marker(map.getCenter()).addTo(map);
        alert("Marcador añadido en el centro del mapa");
    });

    document.getElementById('custom-hand').addEventListener('click', function() {
        alert("Función personalizada activada");
    });
    // Sección 7: Carga de Archivos KML
    // Añadir KML al mapa
    document.getElementById('kml').addEventListener('click', function() {
        document.getElementById('kml-file').click();
    });

    document.getElementById('kml-file').addEventListener('change', function(event) {
        var file = event.target.files[0];
        if (file) {
            var reader = new FileReader();
            reader.onload = function(e) {
                var kmlText = e.target.result;
                var kmlLayer = omnivore.kml.parse(kmlText).on('ready', function() {
                    map.fitBounds(kmlLayer.getBounds());  // Ajustar el mapa a los límites de la capa KML
                }).addTo(map);
            };
            reader.readAsText(file);
        }
    });

    // Sección 8: Colapsar/Expandir Control de Capas
    document.getElementById('toggle-layer-control').addEventListener('click', function() {
        const layerControls = document.getElementById('layer-controls');
        if (layerControls.style.display === 'none' || layerControls.style.display === '') {
            layerControls.style.display = 'block';
        } else {
            layerControls.style.display = 'none';
        }
    });



    // Sección 7: Añadir el buscador GeoSearch
// Sección 7: Añadir el buscador GeoSearch
const provider = new window.GeoSearch.OpenStreetMapProvider({
    params: {
        countrycodes: 'MX', // Limitar la búsqueda a México
        viewbox: [-98.5, 18.0, -94.9, 15.7], // Coordenadas aproximadas de los límites de Oaxaca (longitud oeste, latitud norte, longitud este, latitud sur)
        bounded: 1 // Limitar estrictamente la búsqueda dentro del área definida en viewbox
    }
});

const searchControl = new window.GeoSearch.GeoSearchControl({
    provider: provider,
    style: 'bar',  // Estilo del control de búsqueda
    showMarker: true,
    showPopup: true,
    marker: {
        icon: new L.Icon.Default(),
        draggable: false,
    },
    retainZoomLevel: false,
    animateZoom: true,
    autoClose: true,
    searchLabel: 'Buscar una ubicación',
    keepResult: true,
});

map.addControl(searchControl);

        // Añadir herramientas de dibujo
        var drawnItems = new L.FeatureGroup();
        map.addLayer(drawnItems);

        var drawControl = new L.Control.Draw({
            position: 'topleft',
            draw: {
                polygon: true,
                polyline: true,
                rectangle: true,
                circle: true,
                marker: true
            },
            edit: {
                featureGroup: drawnItems,
                remove: true
            }
        });
        map.addControl(drawControl);

        // Evento para añadir capas dibujadas al mapa
        map.on(L.Draw.Event.CREATED, function (e) {
            var layer = e.layer;
            drawnItems.addLayer(layer);
        });

</script>


</html>
